<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Style AI - Fashion Styling Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50">
    <div id="app"></div>

    <script type="module">
        const { createElement: h, useState, useRef } = React;
        const ReactDOM = window.ReactDOM;

        // Icons
        const CameraIcon = () => h('svg', { xmlns: "http://www.w3.org/2000/svg", width: 24, height: 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round" },
            h('path', { d: "M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z" }),
            h('circle', { cx: 12, cy: 13, r: 3 })
        );

        const UploadIcon = () => h('svg', { xmlns: "http://www.w3.org/2000/svg", width: 24, height: 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round" },
            h('path', { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }),
            h('polyline', { points: "17 8 12 3 7 8" }),
            h('line', { x1: 12, x2: 12, y1: 3, y2: 15 })
        );

        const SparklesIcon = () => h('svg', { xmlns: "http://www.w3.org/2000/svg", width: 24, height: 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round" },
            h('path', { d: "m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" }),
            h('path', { d: "M5 3v4" }),
            h('path', { d: "M19 17v4" }),
            h('path', { d: "M3 5h4" }),
            h('path', { d: "M17 19h4" })
        );

        const RefreshIcon = () => h('svg', { xmlns: "http://www.w3.org/2000/svg", width: 24, height: 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round" },
            h('path', { d: "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" }),
            h('path', { d: "M21 3v5h-5" }),
            h('path', { d: "M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" }),
            h('path', { d: "M3 21v-5h5" })
        );

        const XIcon = () => h('svg', { xmlns: "http://www.w3.org/2000/svg", width: 24, height: 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round" },
            h('path', { d: "M18 6 6 18" }),
            h('path', { d: "m6 6 12 12" })
        );

        const LoaderIcon = () => h('svg', { className: "animate-spin", xmlns: "http://www.w3.org/2000/svg", width: 24, height: 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round" },
            h('path', { d: "M21 12a9 9 0 1 1-6.219-8.56" })
        );

        function FashionStylist() {
            const [image, setImage] = useState(null);
            const [loading, setLoading] = useState(false);
            const [suggestions, setSuggestions] = useState(null);
            const [error, setError] = useState(null);
            const [showStyleSelector, setShowStyleSelector] = useState(false);
            const [selectedStyle, setSelectedStyle] = useState('');
            const [selectedSeason, setSelectedSeason] = useState('');
            const fileInputRef = useRef(null);
            const cameraInputRef = useRef(null);

            const styles = ['Boho', 'Casual', 'Chic', 'Elegant', 'Hippie', 'Minimalist', 'Old money', 'Sporty', 'Streetwear', 'Vintage'];
            const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];

            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setImage(e.target.result);
                        setSuggestions(null);
                        setError(null);
                        setShowStyleSelector(false);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const analyzeFashionItem = async (style = null, season = null) => {
                if (!image) return;

                setLoading(true);
                setError(null);
                setShowStyleSelector(false);
                try {
                    const base64Data = image.split(',')[1];
                    
                    const response = await fetch("/api/analyze.js", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            imageData: base64Data,
                            style: style,
                            season: season
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Failed to analyze image');
                    }

                    const data = await response.json();
                    setSuggestions(data);
                } catch (error) {
                    console.error('Error:', error);
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleRefreshClick = () => {
                setShowStyleSelector(true);
                setSelectedStyle('');
                setSelectedSeason('');
            };

            const handleGenerateWithPreferences = () => {
                if (selectedStyle && selectedSeason) {
                    analyzeFashionItem(selectedStyle, selectedSeason);
                }
            };

            const reset = () => {
                setImage(null);
                setSuggestions(null);
                setLoading(false);
                setError(null);
                setShowStyleSelector(false);
                setSelectedStyle('');
                setSelectedSeason('');
            };

            return h('div', { className: "min-h-screen" },
                // Header
                h('div', { className: "bg-white shadow-sm sticky top-0 z-10" },
                    h('div', { className: "max-w-2xl mx-auto px-4 py-4" },
                        h('div', { className: "flex items-center justify-between" },
                            h('div', { className: "flex items-center gap-2" },
                                h(SparklesIcon),
                                h('h1', { className: "text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent" }, 'Style AI')
                            ),
                            image && h('button', { onClick: reset, className: "text-gray-600 hover:text-gray-800" }, h(XIcon))
                        )
                    )
                ),

                // Main content
                h('div', { className: "max-w-2xl mx-auto px-4 py-6" },
                    !image ? 
                        // Upload section
                        h('div', { className: "space-y-4" },
                            h('div', { className: "bg-white rounded-2xl shadow-lg p-8 text-center" },
                                h('div', { className: "mb-6" },
                                    h('div', { className: "w-20 h-20 mx-auto bg-gradient-to-br from-purple-100 to-pink-100 rounded-full flex items-center justify-center mb-4" },
                                        h(SparklesIcon)
                                    ),
                                    h('h2', { className: "text-2xl font-bold text-gray-800 mb-2" }, 'Style Your Look'),
                                    h('p', { className: "text-gray-600" }, 'Take a photo of any fashion item and get instant styling suggestions')
                                ),
                                h('div', { className: "space-y-3" },
                                    h('input', { 
                                        type: "file", 
                                        ref: cameraInputRef, 
                                        onChange: handleImageUpload, 
                                        accept: "image/*", 
                                        capture: "environment",
                                        className: "hidden" 
                                    }),
                                    h('button', {
                                        onClick: () => cameraInputRef.current?.click(),
                                        className: "w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl font-semibold flex items-center justify-center gap-2 hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg"
                                    },
                                        h(CameraIcon),
                                        'Take Photo'
                                    ),
                                    h('input', { 
                                        type: "file", 
                                        ref: fileInputRef, 
                                        onChange: handleImageUpload, 
                                        accept: "image/*",
                                        className: "hidden" 
                                    }),
                                    h('button', {
                                        onClick: () => fileInputRef.current?.click(),
                                        className: "w-full bg-white border-2 border-purple-200 text-purple-600 py-4 rounded-xl font-semibold flex items-center justify-center gap-2 hover:bg-purple-50 transition-all"
                                    },
                                        h(UploadIcon),
                                        'Upload from Gallery'
                                    )
                                )
                            )
                        )
                    : !suggestions && !showStyleSelector ?
                        // Image preview & analyze
                        h('div', { className: "space-y-4" },
                            h('div', { className: "bg-white rounded-2xl shadow-lg overflow-hidden" },
                                h('img', { src: image, alt: "Fashion item", className: "w-full max-h-96 object-contain bg-gray-50" })
                            ),
                            error && h('div', { className: "bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl" },
                                h('p', { className: "font-semibold" }, 'Error:'),
                                h('p', {}, error)
                            ),
                            h('button', {
                                onClick: () => analyzeFashionItem(),
                                disabled: loading,
                                className: "w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl font-semibold flex items-center justify-center gap-2 hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg disabled:opacity-50"
                            },
                                loading ? [h(LoaderIcon), 'Analyzing...'] : [h(SparklesIcon), 'Get Style Suggestions']
                            )
                        )
                    : showStyleSelector ?
                        // Style & Season selector
                        h('div', { className: "space-y-4" },
                            h('div', { className: "bg-white rounded-2xl shadow-lg overflow-hidden" },
                                h('img', { src: image, alt: "Fashion item", className: "w-full h-48 object-contain bg-gray-50" })
                            ),
                            h('div', { className: "bg-white rounded-2xl shadow-lg p-6" },
                                h('h3', { className: "text-xl font-bold text-gray-800 mb-4" }, 'Choose Your Style'),
                                h('div', { className: "grid grid-cols-2 gap-2 mb-6" },
                                    ...styles.map(style =>
                                        h('button', {
                                            key: style,
                                            onClick: () => setSelectedStyle(style),
                                            className: `py-3 px-4 rounded-lg font-medium transition-all ${
                                                selectedStyle === style 
                                                    ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                            }`
                                        }, style)
                                    )
                                ),
                                h('h3', { className: "text-xl font-bold text-gray-800 mb-4" }, 'Choose Season'),
                                h('div', { className: "grid grid-cols-2 gap-2 mb-6" },
                                    ...seasons.map(season =>
                                        h('button', {
                                            key: season,
                                            onClick: () => setSelectedSeason(season),
                                            className: `py-3 px-4 rounded-lg font-medium transition-all ${
                                                selectedSeason === season 
                                                    ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                            }`
                                        }, season)
                                    )
                                ),
                                h('button', {
                                    onClick: handleGenerateWithPreferences,
                                    disabled: !selectedStyle || !selectedSeason || loading,
                                    className: "w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl font-semibold flex items-center justify-center gap-2 hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                                },
                                    loading ? [h(LoaderIcon), 'Generating...'] : [h(SparklesIcon), 'Generate Suggestions']
                                ),
                                h('button', {
                                    onClick: () => setShowStyleSelector(false),
                                    className: "w-full mt-3 bg-white border-2 border-purple-200 text-purple-600 py-3 rounded-xl font-semibold hover:bg-purple-50 transition-all"
                                }, 'Cancel')
                            )
                        )
                    :
                        // Results
                        h('div', { className: "space-y-4" },
                            // Item description
                            h('div', { className: "bg-white rounded-2xl shadow-lg p-6" },
                                h('img', { src: image, alt: "Fashion item", className: "w-full h-48 object-contain bg-gray-50 rounded-xl mb-4" }),
                                h('h3', { className: "font-semibold text-gray-800 mb-2" }, 'Your Item:'),
                                h('p', { className: "text-gray-600" }, suggestions.itemDescription),
                                h('div', { className: "flex flex-wrap gap-2 mt-3" },
                                    h('span', { className: "px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium" }, suggestions.styleCategory),
                                    ...suggestions.colorPalette.map((color, idx) =>
                                        h('span', { key: idx, className: "px-3 py-1 bg-pink-100 text-pink-700 rounded-full text-sm font-medium" }, color)
                                    )
                                )
                            ),
                            // Outfit suggestions
                            ...suggestions.outfitSuggestions.map((outfit, idx) =>
                                h('div', { key: idx, className: "bg-white rounded-2xl shadow-lg p-6" },
                                    h('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, outfit.name),
                                    h('p', { className: "text-sm text-gray-600 mb-4 italic" }, outfit.vibe),
                                    h('div', { className: "space-y-3" },
                                        h('div', {},
                                            h('h4', { className: "font-semibold text-purple-600 text-sm mb-1" }, 'Tops:'),
                                            h('p', { className: "text-gray-700" }, outfit.items.tops)
                                        ),
                                        h('div', {},
                                            h('h4', { className: "font-semibold text-purple-600 text-sm mb-1" }, 'Bottoms:'),
                                            h('p', { className: "text-gray-700" }, outfit.items.bottoms)
                                        ),
                                        h('div', {},
                                            h('h4', { className: "font-semibold text-purple-600 text-sm mb-1" }, 'Accessories:'),
                                            h('p', { className: "text-gray-700" }, outfit.items.accessories)
                                        )
                                    )
                                )
                            ),
                            // Styling tips
                            h('div', { className: "bg-white rounded-2xl shadow-lg p-6" },
                                h('h3', { className: "text-xl font-bold text-gray-800 mb-4" }, 'ðŸ’¡ Styling Tips'),
                                h('ul', { className: "space-y-2" },
                                    ...suggestions.tips.map((tip, idx) =>
                                        h('li', { key: idx, className: "flex gap-2 text-gray-700" },
                                            h('span', { className: "text-purple-600" }, 'â€¢'),
                                            h('span', {}, tip)
                                        )
                                    )
                                )
                            ),
                            // Refresh button
                            h('button', {
                                onClick: handleRefreshClick,
                                className: "w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl font-semibold flex items-center justify-center gap-2 hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg"
                            },
                                h(RefreshIcon),
                                'Get New Suggestions'
                            ),
                            h('button', {
                                onClick: reset,
                                className: "w-full bg-white border-2 border-purple-200 text-purple-600 py-4 rounded-xl font-semibold hover:bg-purple-50 transition-all"
                            }, 'Style Another Item')
                        )
                )
            );
        }

        ReactDOM.render(h(FashionStylist), document.getElementById('app'));
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</body>
</html>
